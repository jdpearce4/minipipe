

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction to PipeSystems &mdash; minipipe 0.1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> minipipe
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../toy_example.html">Introduction to PipeLine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../into_pipesys.html">Introduction to PipeSystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../into_pipesys.html#Fibonacci-Sequence">Fibonacci Sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../base.html">Base Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pipes.html">Pipes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">minipipe</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Introduction to PipeSystems</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/examples/.ipynb_checkpoints/into_pipesys-checkpoint.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Introduction-to-PipeSystems">
<h1>Introduction to PipeSystems<a class="headerlink" href="#Introduction-to-PipeSystems" title="Permalink to this headline">¶</a></h1>
<p>Minipipe has two API’s, PipeLine and PipeSystem. PipeLine is a simple sequential API for linear pipelines. However, it’s also possible to build more complex pipe systems with Minipipe that may branch and join to form more complex graph topologies. In this section we’ll introduce the concepts of multiple inputs/outputs, switchs and regulators.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">minipipe</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Define functors</span>

<span class="k">def</span> <span class="nf">genRand</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># generates fake data</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="c1"># A coroutine for breaking data up into batches of 2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">//</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">batch_size</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">batch_size</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">sumBatch</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># simple tranform on data</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">switch</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># if-then switch</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">output_gt_1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># sink for greater than 1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1 &lt;&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">output_lt_1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># sink for less than 1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1 &gt;&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>First we’ve introduced a Python coroutine <code class="docutils literal notranslate"><span class="pre">batch</span></code>. This coroutine breaks up the data into batches of size 2. This is an example of a Regulator functor.</p>
<p>We’ve also introduced the concept of a switch functor. This functor has two outputs, in this case a list with two elements, however we could have just as easily used a standard tuple. When a Python <code class="docutils literal notranslate"><span class="pre">None</span></code> is encountered in a pipe segment it is simple ignored. Thus <code class="docutils literal notranslate"><span class="pre">switch</span></code> returns x in either the first or second output depending on the value of x.</p>
<p>The PipeSystem API allows you to define general graphs that may branch and join however you choose. In the PipeSystem API you explicitly define the nodes (Pipes) and edges (Streams) of your graph.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define streams</span>

<span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">,</span> <span class="n">s5</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Stream</span><span class="p">(),</span> <span class="n">mp</span><span class="o">.</span><span class="n">Stream</span><span class="p">(),</span> <span class="n">mp</span><span class="o">.</span><span class="n">Stream</span><span class="p">(),</span> <span class="n">mp</span><span class="o">.</span><span class="n">Stream</span><span class="p">(),</span> <span class="n">mp</span><span class="o">.</span><span class="n">Stream</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create Pipe segments with up/downstreams</span>
<span class="c1"># Order is not important</span>

<span class="n">pipes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">genRand</span><span class="p">,</span> <span class="s1">&#39;source1&#39;</span><span class="p">,</span> <span class="n">downstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s1</span><span class="p">]),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">genRand</span><span class="p">,</span> <span class="s1">&#39;source2&#39;</span><span class="p">,</span> <span class="n">downstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s1</span><span class="p">]),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">Regulator</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="s1">&#39;batcher&#39;</span><span class="p">,</span> <span class="n">upstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s1</span><span class="p">],</span> <span class="n">downstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s2</span><span class="p">]),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">sumBatch</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">upstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s2</span><span class="p">],</span> <span class="n">downstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s3</span><span class="p">]),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">switch</span><span class="p">,</span> <span class="s1">&#39;switch&#39;</span><span class="p">,</span> <span class="n">upstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s3</span><span class="p">],</span> <span class="n">downstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s4</span><span class="p">,</span> <span class="n">s5</span><span class="p">]),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">Sink</span><span class="p">(</span><span class="n">output_gt_1</span><span class="p">,</span> <span class="s1">&#39;print_gt_1&#39;</span><span class="p">,</span> <span class="n">upstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s4</span><span class="p">]),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">Sink</span><span class="p">(</span><span class="n">output_lt_1</span><span class="p">,</span> <span class="s1">&#39;print_lt_1&#39;</span><span class="p">,</span> <span class="n">upstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s5</span><span class="p">]),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">switch</span></code> has two outputs it must have two downstreams, otherwise the list/tuple will be interpreted as a single output. Pipe segments may also have multiple inputs, in which case they must have multiple upstreams.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Build pipesystem</span>

<span class="n">psys</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">PipeSystem</span><span class="p">(</span><span class="n">pipes</span><span class="p">)</span>
<span class="n">psys</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">psys</span><span class="o">.</span><span class="n">diagram</span><span class="p">(</span><span class="n">draw_streams</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_.ipynb_checkpoints_into_pipesys-checkpoint_8_0.svg" src="../../_images/examples_.ipynb_checkpoints_into_pipesys-checkpoint_8_0.svg" /></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run pipesystem</span>

<span class="n">psys</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">psys</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2019-12-13 19:08:00,866 - INFO - source1 - End of stream
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1 &lt; 1.5679524130331748
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2019-12-13 19:08:00,878 - INFO - source1 - Local termination
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1 &lt; 1.4769439269027278
1 &lt; 1.0743556969907908
1 &gt; 0.2705892033763937
1 &gt; 0.9882292069339867
1 &gt; 0.9212305814786037
1 &lt; 1.5679524130331748
1 &gt; 0.954962071386282
1 &gt; 0.790318022693491
1 &lt; 1.4769439269027278
1 &gt; 0.2705892033763937
1 &lt; 1.0743556969907908
1 &gt; 0.9174229362808922
1 &gt; 0.8151774581968392
1 &gt; 0.9882292069339867
1 &gt; 0.9212305814786037
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2019-12-13 19:08:00,892 - INFO - print_gt_1 - Local termination
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1 &gt; 0.954962071386282
1 &gt; 0.790318022693491
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2019-12-13 19:08:00,895 - INFO - print_lt_1 - Local termination
2019-12-13 19:08:00,887 - INFO - batcher - Local termination
2019-12-13 19:08:00,884 - INFO - source2 - End of stream
2019-12-13 19:08:00,889 - INFO - sum - Local termination
2019-12-13 19:08:00,920 - INFO - source2 - Local termination
2019-12-13 19:08:00,895 - INFO - switch - Local termination
</pre></div></div>
</div>
</div>
<div class="section" id="Fibonacci-Sequence">
<h1>Fibonacci Sequence<a class="headerlink" href="#Fibonacci-Sequence" title="Permalink to this headline">¶</a></h1>
<p>With the PipSystem API its possible to build graphs with loops. Loops can be used to store states in a Stream (class functors also allow for this, see the next section). Here’s a useless example calculating the Fibonacci sequence with a stateless functor.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Event</span>

<span class="n">s1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Stream</span><span class="p">()</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Stream</span><span class="p">()</span>

<span class="n">term_flag</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span> <span class="c1"># minipipe uses multiprocessing Events for termination flags</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span> <span class="c1"># max fib number</span>

<span class="c1"># initialize streams instead of using a Source</span>
<span class="n">s1</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">s2</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">x_1</span><span class="p">,</span> <span class="n">x_2</span><span class="p">):</span>

    <span class="c1"># terminate when n is reached</span>
    <span class="k">if</span> <span class="n">x_1</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">term_flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">x_1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x_2</span><span class="p">,</span> <span class="n">x_1</span> <span class="o">+</span> <span class="n">x_2</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">fib</span><span class="p">,</span> <span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="n">upstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">],</span> <span class="n">downstreams</span><span class="o">=</span><span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">])</span>
<span class="n">p</span><span class="o">.</span><span class="n">set_term_flag</span><span class="p">(</span><span class="n">term_flag</span><span class="p">)</span> <span class="c1"># term flag needs to be set explicitly</span>

<span class="n">psys</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">PipeSystem</span><span class="p">([</span><span class="n">p</span><span class="p">])</span>
<span class="n">psys</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">psys</span><span class="o">.</span><span class="n">diagram</span><span class="p">(</span><span class="n">draw_streams</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_.ipynb_checkpoints_into_pipesys-checkpoint_13_0.svg" src="../../_images/examples_.ipynb_checkpoints_into_pipesys-checkpoint_13_0.svg" /></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">psys</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">psys</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
1
1
2
3
5
8
13
21
34
55
89
144
233
377
610
987
1597
2584
4181
6765
10946
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, James D. Pearce

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>